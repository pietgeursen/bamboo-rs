<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Verify a batch of `signatures` on `messages` with their respective `public_keys`."><meta name="keywords" content="rust, rustlang, rust-lang, verify_batch"><title>verify_batch in ed25519_dalek - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings"></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../favicon.svg">
<link rel="alternate icon" type="image/png" href="../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../ed25519_dalek/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><div class="sidebar-elems"><h2 class="location">Other items in<br><a href="index.html">ed25519_dalek</a></h2><div id="sidebar-vars" data-name="verify_batch" data-ty="fn" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img src="../brush.svg" width="18" height="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img src="../wheel.svg" width="18" height="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Function <a href="index.html">ed25519_dalek</a>::<wbr><a class="fn" href="#">verify_batch</a><button id="copy-path" onclick="copy_path(this)" title="copy path"><img src="../clipboard.svg" width="19" height="18" alt="Copy item import" title="Copy item import to clipboard"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/ed25519_dalek/batch.rs.html#221-305" title="goto source code">[src]</a></span></h1><pre class="rust fn">pub fn verify_batch(<br>&nbsp;&nbsp;&nbsp;&nbsp;messages: <a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.slice.html">&amp;[</a><a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.slice.html">&amp;[</a><a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.u8.html">u8</a><a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.slice.html">]</a><a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.slice.html">]</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;signatures: <a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.slice.html">&amp;[</a><a class="struct" href="struct.Signature.html" title="struct ed25519_dalek::Signature">Signature</a><a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.slice.html">]</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;public_keys: <a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.slice.html">&amp;[</a><a class="struct" href="struct.PublicKey.html" title="struct ed25519_dalek::PublicKey">PublicKey</a><a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.slice.html">]</a><br>) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.54.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.unit.html">()</a>, <a class="type" href="type.SignatureError.html" title="type ed25519_dalek::SignatureError">SignatureError</a>&gt;</pre><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Verify a batch of <code>signatures</code> on <code>messages</code> with their respective <code>public_keys</code>.</p>
<h1 id="inputs" class="section-header"><a href="#inputs">Inputs</a></h1>
<ul>
<li><code>messages</code> is a slice of byte slices, one per signed message.</li>
<li><code>signatures</code> is a slice of <code>Signature</code>s.</li>
<li><code>public_keys</code> is a slice of <code>PublicKey</code>s.</li>
</ul>
<h1 id="returns" class="section-header"><a href="#returns">Returns</a></h1>
<ul>
<li>A <code>Result</code> whose <code>Ok</code> value is an emtpy tuple and whose <code>Err</code> value is a
<code>SignatureError</code> containing a description of the internal error which
occured.</li>
</ul>
<h1 id="notes-on-nonce-generation--malleability" class="section-header"><a href="#notes-on-nonce-generation--malleability">Notes on Nonce Generation &amp; Malleability</a></h1><h2 id="on-synthetic-nonces" class="section-header"><a href="#on-synthetic-nonces">On Synthetic Nonces</a></h2>
<p>This library defaults to using what is called “synthetic” nonces, which
means that a mixture of deterministic (per any unique set of inputs to this
function) data and system randomness is used to seed the CSPRNG for nonce
generation.  For more of the background theory on why many cryptographers
currently believe this to be superior to either purely deterministic
generation or purely relying on the system’s randomness, see <a href="https://merlin.cool/transcript/rng.html">this section
of the Merlin design</a> by Henry de
Valence, isis lovecruft, and Oleg Andreev, as well as Trevor Perrin’s
<a href="https://moderncrypto.org/mail-archive/curves/2017/000925.html">designs for generalised
EdDSA</a>.</p>
<h2 id="on-deterministic-nonces" class="section-header"><a href="#on-deterministic-nonces">On Deterministic Nonces</a></h2>
<p>In order to be ammenable to protocols which require stricter third-party
auditability trails, such as in some financial cryptographic settings, this
library also supports a <code>--features=batch_deterministic</code> setting, where the
nonces for batch signature verification are derived purely from the inputs
to this function themselves.</p>
<p><strong>This is not recommended for use unless you have several cryptographers on
staff who can advise you in its usage and all the horrible, terrible,
awful ways it can go horribly, terribly, awfully wrong.</strong></p>
<p>In any sigma protocol it is wise to include as much context pertaining
to the public state in the protocol as possible, to avoid malleability
attacks where an adversary alters publics in an algebraic manner that
manages to satisfy the equations for the protocol in question.</p>
<p>For ed25519 batch verification (both with synthetic and deterministic nonce
generation), we include the following as scalars in the protocol transcript:</p>
<ul>
<li>All of the computed <code>H(R||A||M)</code>s to the protocol transcript, and</li>
<li>All of the <code>s</code> components of each signature.</li>
</ul>
<p>Each is also prefixed with their index in the vector.</p>
<p>The former, while not quite as elegant as adding the <code>R</code>s, <code>A</code>s, and
<code>M</code>s separately, saves us a bit of context hashing since the
<code>H(R||A||M)</code>s need to be computed for the verification equation anyway.</p>
<p>The latter prevents a malleability attack only found in deterministic batch
signature verification (i.e. only when compiling <code>ed25519-dalek</code> with
<code>--features batch_deterministic</code>) wherein an adversary, without access
to the signing key(s), can take any valid signature, <code>(s,R)</code>, and swap
<code>s</code> with <code>s' = -z1</code>.  This doesn’t contitute a signature forgery, merely
a vulnerability, as the resulting signature will not pass single
signature verification.  (Thanks to Github users @real_or_random and
@jonasnick for pointing out this malleability issue.)</p>
<p>For an additional way in which signatures can be made to probablistically
falsely “pass” the synthethic batch verification equation <em>for the same
inputs</em>, but <em>only some crafted inputs</em> will pass the deterministic batch
single, and neither of these will ever pass single signature verification,
see the documentation for [<code>PublicKey.validate()</code>].</p>
<h1 id="examples" class="section-header"><a href="#examples">Examples</a></h1>
<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">ed25519_dalek</span>;
<span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">rand</span>;

<span class="kw">use</span> <span class="ident">ed25519_dalek::verify_batch</span>;
<span class="kw">use</span> <span class="ident">ed25519_dalek::Keypair</span>;
<span class="kw">use</span> <span class="ident">ed25519_dalek::PublicKey</span>;
<span class="kw">use</span> <span class="ident">ed25519_dalek::Signer</span>;
<span class="kw">use</span> <span class="ident">ed25519_dalek::Signature</span>;
<span class="kw">use</span> <span class="ident">rand::rngs::OsRng</span>;

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">csprng</span> <span class="op">=</span> <span class="ident">OsRng</span>{};
<span class="kw">let</span> <span class="ident">keypairs</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">Keypair</span><span class="op">&gt;</span> <span class="op">=</span> (<span class="number">0</span>..<span class="number">64</span>).<span class="ident">map</span>(<span class="op">|</span><span class="kw">_</span><span class="op">|</span> <span class="ident">Keypair::generate</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">csprng</span>)).<span class="ident">collect</span>();
<span class="kw">let</span> <span class="ident">msg</span>: <span class="kw-2">&amp;</span>[<span class="ident">u8</span>] <span class="op">=</span> <span class="string">b&quot;They&#39;re good dogs Brant&quot;</span>;
<span class="kw">let</span> <span class="ident">messages</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="kw-2">&amp;</span>[<span class="ident">u8</span>]<span class="op">&gt;</span> <span class="op">=</span> (<span class="number">0</span>..<span class="number">64</span>).<span class="ident">map</span>(<span class="op">|</span><span class="kw">_</span><span class="op">|</span> <span class="ident">msg</span>).<span class="ident">collect</span>();
<span class="kw">let</span> <span class="ident">signatures</span>:  <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">Signature</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">keypairs</span>.<span class="ident">iter</span>().<span class="ident">map</span>(<span class="op">|</span><span class="ident">key</span><span class="op">|</span> <span class="ident">key</span>.<span class="ident">sign</span>(<span class="kw-2">&amp;</span><span class="ident">msg</span>)).<span class="ident">collect</span>();
<span class="kw">let</span> <span class="ident">public_keys</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">PublicKey</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">keypairs</span>.<span class="ident">iter</span>().<span class="ident">map</span>(<span class="op">|</span><span class="ident">key</span><span class="op">|</span> <span class="ident">key</span>.<span class="ident">public</span>).<span class="ident">collect</span>();

<span class="kw">let</span> <span class="ident">result</span> <span class="op">=</span> <span class="ident">verify_batch</span>(<span class="kw-2">&amp;</span><span class="ident">messages</span>[..], <span class="kw-2">&amp;</span><span class="ident">signatures</span>[..], <span class="kw-2">&amp;</span><span class="ident">public_keys</span>[..]);
<span class="macro">assert!</span>(<span class="ident">result</span>.<span class="ident">is_ok</span>());</pre></div>
</div></details></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="ed25519_dalek" data-search-index-js="../search-index.js" data-search-js="../search.js"></div><script src="../main.js"></script></body></html>